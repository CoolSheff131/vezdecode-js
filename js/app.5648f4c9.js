(()=>{"use strict";var t={766:(t,e,s)=>{var r=s(8935),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("Header",[s("CloseButton")],1),s("Content",{attrs:{header:!0,footer:!1,scroll:!0,scrollbar:!0}},[null!==t.userChange?s("div",[s("h1",[t._v(t._s(t.userChange.name))]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.newUserPoints,expression:"newUserPoints"}],attrs:{type:"number"},domProps:{value:t.newUserPoints},on:{input:function(e){e.target.composing||(t.newUserPoints=e.target.value)}}}),s("button",{on:{click:function(e){return t.cancelChangeUser()}}},[t._v("Отмена")]),s("button",{on:{click:function(e){return t.changeUser()}}},[t._v("Изменить")])]):t._e(),t.isLoadingUsers?s("Spinner"):s("ul",t._l(t.allUsers,(function(e){return s("li",{key:e.id},[s("span",[t._v(" Имя: "+t._s(e.name)+" ")]),s("span",[t._v(" Баллы: "+t._s(e.points)+" ")]),s("button",{on:{click:function(s){return t.startChangeUser(e)}}},[t._v("Изменить")])])})),0),s("div",{staticClass:"mt-6 text-center"},[s("Button",{staticClass:"w-280",on:{setBarcode:t.setBarcode}},[s("template",{slot:"text"},[t._v("Сканировать QR-код из задания за 10")])],2)],1),t.isLoadingUsers?s("Spinner"):s("div",[s("h1",[t._v("Для покупок выберите пользователя")]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.currentUser,expression:"currentUser"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.currentUser=e.target.multiple?s:s[0]}}},t._l(t.allUsers,(function(e){return s("option",{key:e.id,domProps:{value:e}},[t._v(t._s(e.name))])})),0)]),s("div",{staticClass:"mx-2 mt-6 text-xl text-center",attrs:{"v-if":null!==t.currentUser}},[s("b",[t._v(t._s(t.currentUser&&t.currentUser.name))]),s("hr"),s("b",[t._v(t._s(t.currentUser&&"Баллы: "+t.currentUser.points))])]),t.isLoadingProducts?s("Spinner"):s("ul",t._l(t.products,(function(e){return s("li",{key:e.id},[s("span",[t._v(" Название: "+t._s(e.name)+" ")]),s("span",[t._v(" Стоимость: "+t._s(e.cost)+" ")]),t.currentUser?s("button",{attrs:{disabled:e.cost>t.currentUser.points},on:{click:function(s){return t.buyProduct(e)}}},[t._v(" Купить ")]):t._e()])})),0)],1),s("Modal",{attrs:{isVisible:t.modal.show,qrCodeValue:t.qrValue},on:{onClose:function(e){t.modal.show=!1}}})],1)},o=[],a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"fixed w-screen top-0 left-0 border-b z-10 bg-gray-50",class:t.$slots.default?"h-[var(--header-sait]":"h-[var(--sait)]"},[t.$slots.default?s("div",{staticClass:"mt-sait w-screen h-[var(--header-height)]"},[t._t("default")],2):t._e()])},i=[];const l={name:"Header"},c=l;var u=s(1001),d=(0,u.Z)(c,a,i,!1,null,null,null);const h=d.exports;var p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex items-center w-screen h-full"},[s("button",{staticClass:"group flex flex-row outline-none h-8 items-center ml-0 pr-2",on:{click:t.onClick}},[s("svg",{staticClass:"h-6 w-6 group-active:stroke-orange-500",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"}},[s("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"}})]),s("div",[t._v(t._s(t.name))])])])},f=[],m=s(2907),v=s.n(m);const g={name:"CloseButton",props:{name:{type:String,default:"Close"}},methods:{onClick(){v().miniapp.pop(!0,"")}}},k=g;var y=(0,u.Z)(k,p,f,!1,null,null,null);const w=y.exports;var C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"w-screen",class:[t.header?"mt-[var(--header-sait)]":"",t.calc_height,t.scroll?"overflow-y-auto":"overflow-hidden",t.scrollbar?"scrollbar":""],attrs:{hidden:t.hidden},on:{scroll:t.onscroll}},[t._t("default")],2)},b=[];const _={name:"Content",props:{header:{type:Boolean,default:!0},footer:{type:Boolean,default:!1},scroll:{type:Boolean,default:!0},scrollbar:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},data(){return{timer:null}},computed:{calc_height(){return this.header?this.footer?"h-[calc(100vh-var(--header-sait)-var(--footer-saib))]":"h-[calc(100vh-var(--header-sait))]":this.footer?"h-[calc(100vh-var(--footer-saib))]":"h-screen"}},methods:{onscroll(t){t.target.scrollTop>10&&document.documentElement.style.setProperty("--scrollbar-opacity","block"),clearTimeout(this.timer),this.timer=setTimeout((()=>{document.documentElement.style.setProperty("--scrollbar-opacity","none")}),2e3)}}},x=_;var U=(0,u.Z)(x,C,b,!1,null,null,null);const P=U.exports;var O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("button",{staticClass:"text-center px-4 py-2 rounded-md transition-all shadow-md ring-2 font-semibold",class:t.danger?"bg-white ring-red-500 active:ring-red-400 active:bg-red-50 m-0.5":"text-white bg-orange-500 ring-orange-500 active:bg-orange-400 active:ring-orange-400",on:{click:t.onClick}},[s("div",{staticClass:"flex items-center"},[s("LoadingIcon",{staticClass:"w-7 px-0.5 animate-spin-slow",attrs:{stroke:t.danger?"rgb(249 115 22)":"#fffff0",className:t.isLoading?"block":"hidden"}}),!t.isLoading&&t.isLoading||t.$slots.icon?s("div",{staticClass:"w-7"},[t._t("icon")],2):t._e(),s("div",{staticClass:"text-lg text-center w-full transition-padding",class:t.isLoading||t.$slots.icon?"pl-9 -ml-7":""},[t._t("text")],2)],1)])},B=[],S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.className},[s("svg",{attrs:{version:"1.1",viewBox:"-58 -58 116 116",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},[s("g",{attrs:{"stroke-linecap":"round","stroke-width":"15"}},[s("path",{attrs:{id:"a",d:"m0 35 0,14"}}),s("use",{attrs:{transform:"rotate(210)","xlink:href":"#a",stroke:t.stroke,opacity:"0.08"}}),s("use",{attrs:{transform:"rotate(240)","xlink:href":"#a",stroke:t.stroke,opacity:"0.16"}}),s("use",{attrs:{transform:"rotate(270)","xlink:href":"#a",stroke:t.stroke,opacity:"0.25"}}),s("use",{attrs:{transform:"rotate(300)","xlink:href":"#a",stroke:t.stroke,opacity:"0.33"}}),s("use",{attrs:{transform:"rotate(330)","xlink:href":"#a",stroke:t.stroke,opacity:"0.41"}}),s("use",{attrs:{transform:"rotate(0)","xlink:href":"#a",stroke:t.stroke,opacity:"0.50"}}),s("use",{attrs:{transform:"rotate(30)","xlink:href":"#a",stroke:t.stroke,opacity:"0.58"}}),s("use",{attrs:{transform:"rotate(60)","xlink:href":"#a",stroke:t.stroke,opacity:"0.67"}}),s("use",{attrs:{transform:"rotate(90)","xlink:href":"#a",stroke:t.stroke,opacity:"0.75"}}),s("use",{attrs:{transform:"rotate(120)","xlink:href":"#a",stroke:t.stroke,opacity:"0.83"}}),s("use",{attrs:{transform:"rotate(150)","xlink:href":"#a",stroke:t.stroke,opacity:"0.92"}}),s("use",{attrs:{transform:"rotate(180)","xlink:href":"#a",stroke:t.stroke,opacity:"1.0"}})])])])},$=[];const L={name:"LoadingIcon",props:{stroke:{type:String,default:""},className:{type:String,default:"#ffff00"}}},j=L;var E=(0,u.Z)(j,S,$,!1,null,null,null);const T=E.exports,V={name:"Button",props:{danger:{type:Boolean,default:!1}},components:{LoadingIcon:T},data(){return{isLoading:!1}},methods:{async onClick(){const t=await v().barcode.scan([v().barcode.symbology.qr]);this.$emit("setBarcode",t)}}},Z=V;var A=(0,u.Z)(Z,O,B,!1,null,null,null);const N=A.exports;var q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"w-full h-full flex justify-center"},[s("svg",{staticClass:"transition-opacity animate-spin text-black self-center duration-500 opacity-100",class:t.width,attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"}},[s("circle",{staticClass:"opacity-25",attrs:{cx:"12",cy:"12",r:"10",stroke:t.stroke,"stroke-width":"4"}}),s("path",{staticClass:"opacity-75",attrs:{fill:t.fill,d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"}})])])},M=[];const z={name:"Spinner",props:{width:{type:String,default:"w-6"},fill:{type:String,default:"grey"},stroke:{type:String,default:"grey"}}},I=z;var H=(0,u.Z)(I,q,M,!1,null,null,null);const J=H.exports;var Q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"h-screen w-screen z-20 absolute inset-0 bg-black/25",class:t.isVisible?"block ":t.isOpen?"block":"hidden",on:{click:t.onClose}},[s("div",{staticClass:"w-full bg-white absolute bottom-0 rounded-t-3xl transition-height duration-300",class:t.isOpen?"h-2/3 ease-out":"h-0 ease-out",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"p-6"},[s("qrcode-vue",{attrs:{value:t.qrCodeValue,size:t.size,level:"H"}}),t._t("default")],2)])])},D=[],F=s(1147);const R={name:"Modal",components:{QrcodeVue:F.Z},props:{isVisible:{type:Boolean,default:!1},qrCodeValue:String},data(){return{size:300,timeout:350,isOpen:!1}},watch:{isVisible(t){t&&this.onOpen()}},mounted(){this.onOpen()},methods:{onClose(){this.isOpen=!1,setTimeout((()=>{this.$emit("onClose")}),this.timeout)},onOpen(){setTimeout((()=>{this.isOpen=this.isVisible}),this.timeout)}}},G=R;var K=(0,u.Z)(G,Q,D,!1,null,null,null);const W=K.exports,X={name:"App",components:{Spinner:J,Modal:W,Content:P,Header:h,CloseButton:w,Button:N},data(){return{newUserPoints:0,userChange:null,currentUser:null,allUsers:[],isLoadingUsers:!1,modal:{show:!1},products:[],isLoadingProducts:!1,qrValue:"",spinner:!0}},mounted(){this.getUsers(),this.getProducts()},methods:{getUsers(){this.isLoadingUsers=!0,fetch("https://almond-vast-salute.glitch.me/users").then((t=>t.json())).then((t=>{this.allUsers=t,this.isLoadingUsers=!1,console.log(this.allUsers)}))},getProducts(){this.isLoadingProducts=!0,fetch("https://almond-vast-salute.glitch.me/products").then((t=>t.json())).then((t=>{this.isLoadingProducts=!1,this.products=t,console.log(this.products)}))},cancelChangeUser(){this.userChange=null},changeUser(){this.userChange&&fetch(`https://almond-vast-salute.glitch.me/users/${this.userChange.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.userChange.id,name:this.userChange.name,points:this.newUserPoints})}).then((t=>t.json())).then((t=>{console.log(t),this.userChange=null,this.getUsers()}))},startChangeUser(t){this.userChange=t,this.newUserPoints=t.points||200},Encrypt(t){let e=new String,s=new Array,r=new Array,n=t.length;for(let o=0;o<n;o++){let e=Math.round(122*Math.random())+68;s[o]=t.charCodeAt(o)+e,r[o]=e}for(let o=0;o<n;o++)e+=String.fromCharCode(s[o],r[o]);return e},unEncrypt(t){let e=new String,s=new Array,r=new Array,n=t.length;for(let o=0;o<n;o++)s[o]=t.charCodeAt(o),r[o]=t.charCodeAt(o+1);for(let o=0;o<n;o+=2)e+=String.fromCharCode(s[o]-r[o]);return e},buyProduct(t){let e=JSON.stringify({userId:this.currentUser.id,productId:t.id,date:Date()}),s=this.Encrypt(e);this.qrValue=s,this.modal.show=!0},setBarcode(t){let e=this.unEncrypt(t.result);const s=JSON.parse(e);fetch(`https://almond-vast-salute.glitch.me/users/${s.userId}`).then((t=>t.json())).then((t=>{fetch(`https://almond-vast-salute.glitch.me/products/${s.productId}`).then((t=>t.json())).then((e=>{const s=t.points-e.cost;fetch(`https://almond-vast-salute.glitch.me/users/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id,name:t.name,points:s})}).then((t=>t.json())).then((t=>{this.getUsers()}))}))}))}}},Y=X;var tt=(0,u.Z)(Y,n,o,!1,null,null,null);const et=tt.exports;r.Z.config.productionTip=!1,new r.Z({render:t=>t(et)}).$mount("#app")}},e={};function s(r){var n=e[r];if(void 0!==n)return n.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,s),o.exports}s.m=t,(()=>{var t=[];s.O=(e,r,n,o)=>{if(!r){var a=1/0;for(u=0;u<t.length;u++){for(var[r,n,o]=t[u],i=!0,l=0;l<r.length;l++)(!1&o||a>=o)&&Object.keys(s.O).every((t=>s.O[t](r[l])))?r.splice(l--,1):(i=!1,o<a&&(a=o));if(i){t.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}o=o||0;for(var u=t.length;u>0&&t[u-1][2]>o;u--)t[u]=t[u-1];t[u]=[r,n,o]}})(),(()=>{s.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return s.d(e,{a:e}),e}})(),(()=>{s.d=(t,e)=>{for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{var t={143:0};s.O.j=e=>0===t[e];var e=(e,r)=>{var n,o,[a,i,l]=r,c=0;if(a.some((e=>0!==t[e]))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(l)var u=l(s)}for(e&&e(r);c<a.length;c++)o=a[c],s.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return s.O(u)},r=globalThis["webpackChunkvue_miniapp_template"]=globalThis["webpackChunkvue_miniapp_template"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var r=s.O(void 0,[998],(()=>s(766)));r=s.O(r)})();